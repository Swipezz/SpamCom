<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="static/style/styletest.css">
    <title>SpamCom</title>
</head>
<body>
    <div id="container1" class="position-relative">
        <img id="frameimg" src="/static/public/Frame.png" alt="">
        <img id="garisimg" src="/static/public/Garis.png" alt="">
        <!-- <img id="cursor" src="/static/public/Cursor.png" alt=""> -->
        <div id="container2">
            <img id="innerimg" src="/static/public/Inner.png" alt="">
            <div id="grid-container">
                <div class="borderpopup">
                    <div class="insidepopup">
                        <div class="headpopup">
                            Head
                        </div>
                        <div class="bodypopup">
                            Body
                        </div>
                    </div>
                </div>
                <div id="1" class="grid-item"><div id="btn1" class="follow-element"><img class="mail" src="/static/public/Mail.png" alt=""></div></div>
                <div id="2" class="grid-item"><div id="btn2" class="follow-element"><img class="mail" src="/static/public/Mail.png" alt=""></div></div>
                <div id="3" class="grid-item"><div id="btn3" class="follow-element"><img class="mail" src="/static/public/Mail.png" alt=""></div></div>
                <div id="4" class="grid-item"><div id="btn4" class="follow-element"><img class="mail" src="/static/public/Mail.png" alt=""></div></div>
                <div id="5" class="grid-item"></div>
                <div id="6" class="grid-item"></div>
                <div id="7" class="grid-item"></div>
                <div id="8" class="grid-item"></div>
                <div id="9" class="grid-item"></div>
                <div id="10" class="grid-item"></div>
                <div id="11" class="grid-item"></div>
                <div id="12" class="grid-item"><div id="btn12" class="solid-element"><img id="send" src="/static/public/Send.png" alt=""></div></div>
                <div id="13" class="grid-item"></div>
                <div id="14" class="grid-item"></div>
                <div id="15" class="grid-item"></div>
                <div id="16" class="grid-item"></div>
                <div id="17" class="grid-item"></div>
                <div id="18" class="grid-item"></div>
                <div id="19" class="grid-item"></div>
                <div id="20" class="grid-item"></div>
                <div id="21" class="grid-item"></div>
                <div id="22" class="grid-item"></div>
                <div id="23" class="grid-item"></div>
                <div id="24" class="grid-item"></div>
                <div id="25" class="grid-item"></div>
                <div id="26" class="grid-item"></div>
                <div id="27" class="grid-item"></div>
                <div id="28" class="grid-item"></div>
                <div id="29" class="grid-item"></div>
                <div id="30" class="grid-item"></div>
                <div id="31" class="grid-item"></div>
                <div id="32" class="grid-item"></div>
                <div id="33" class="grid-item"></div>
                <div id="34" class="grid-item"></div>
                <div id="35" class="grid-item"></div>
                <div id="36" class="grid-item"></div>
                <div id="37" class="grid-item"></div>
                <div id="38" class="grid-item"></div>
                <div id="39" class="grid-item"></div>
                <div id="40" class="grid-item"></div>
                <div id="41" class="grid-item"></div>
                <div id="42" class="grid-item"></div>
                <div id="43" class="grid-item"></div>
                <div id="44" class="grid-item"></div>
                <div id="45" class="grid-item"></div>
                <div id="46" class="grid-item"></div>
                <div id="47" class="grid-item"></div>
                <div id="48" class="grid-item"></div>
                <div id="49" class="grid-item"></div>
                <div id="50" class="grid-item"></div>
                <div id="51" class="grid-item"></div>
                <div id="52" class="grid-item"></div>
                <div id="53" class="grid-item"></div>
                <div id="54" class="grid-item"></div>
                <div id="55" class="grid-item"></div>
                <div id="56" class="grid-item"></div>
                <div id="57" class="grid-item"></div>
                <div id="58" class="grid-item"></div>
                <div id="59" class="grid-item"></div>
                <div id="60" class="grid-item"></div>
                <div id="61" class="grid-item"></div>
                <div id="62" class="grid-item"></div>
                <div id="63" class="grid-item"></div>
                <div id="64" class="grid-item"></div>
                <div id="65" class="grid-item"></div>
                <div id="66" class="grid-item"></div>
                <div id="67" class="grid-item"></div>
                <div id="68" class="grid-item"></div>
                <div id="69" class="grid-item"></div>
                <div id="70" class="grid-item"></div>
                <div id="71" class="grid-item"></div>
                <div id="72" class="grid-item"><div id="btn72" class="solid-element"><img id="recycle" src="/static/public/Recycle.png" alt=""></div></div>
            </div>
            <div id="taskbar">
                <div id="leftborder">
                    <img id="startimg" src="/static/public/Start.png" alt="">
                </div>
                <div id="rightborder">
                    <div id="volumeborder">
                        <img id="volumeimg" src="/static/public/Volume.png" alt="">
                    </div>
                    <div id="moneyborder">
                        <p id="money">0000$</p>
                    </div>
                    <div id="timeborder">
                        <p id="time"></p>
                    </div>
                </div>
            </div>
        </div>
    <script>
var followItems = document.querySelectorAll(".follow-element")
var gridTiles = document.querySelectorAll(".grid-item")
var gridContainer = document.getElementById("grid-container")
var container2 = document.getElementById("container2")
var container1 = document.getElementById("container1")
var cursor = document.getElementById("cursor")
var cursorParent = cursor.parentElement

function displayUserLocalTime() {
    const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
    const now = new Date().toLocaleString("en-US", {timeZone: userTimezone});
    const date = new Date(now)
    var formatDate = date.getHours()+":"+date.getMinutes()
    document.getElementById("time").textContent = formatDate;
}
displayUserLocalTime();
setInterval(displayUserLocalTime, 60000);

function moveItem(event) {
    if (this.dataset.active === "true") {
        var containerRect = this.parentElement.getBoundingClientRect()
        var maxX = containerRect.width - this.offsetWidth
        var maxY = containerRect.height - this.offsetHeight

        var newX = Math.min(maxX, Math.max(0, event.clientX - containerRect.left - this.offsetWidth / 2))
        var newY = Math.min(maxY, Math.max(0, event.clientY - containerRect.top - this.offsetHeight / 2))

        this.style.left = newX + "px"
        this.style.top = newY + "px"
    }
}

// Move cursor
document.addEventListener("mousemove", function(event) {
    let parentRect = cursorParent.getBoundingClientRect()
    let newX = event.clientX - parentRect.left - cursor.offsetWidth / 2
    let newY = event.clientY - parentRect.top - cursor.offsetHeight / 2

    newX = Math.min(Math.max(newX, 0), parentRect.width - cursor.offsetWidth)
    newY = Math.min(Math.max(newY, 0), parentRect.height - cursor.offsetHeight)

    cursor.style.left = newX + "px"
    cursor.style.top = newY + "px"
})

// Drag item
var onHold = false
var onMove = false
var onItem = ""
var clickTimeout

followItems.forEach(function(item) {
    item.addEventListener("mousedown", function(event) {
        clickTimeout = setTimeout(() => {
            onHold = true
            childParent = item.parentNode.id
            item.dataset.active = "true"
            
            if (item.dataset.active == "true") {
                let rect = document.getElementById("1").getBoundingClientRect()
                let height = rect.height
                let width = rect.width
                item.style.height = height + "px"
                item.style.width = width + "px"
            }

            item.style.pointerEvents = "none"
            item.style.position = "absolute"

            onItem = item
        }, 130)
    })

    item.addEventListener("mouseup", function(event) {
        clearTimeout(clickTimeout)
    })
    item.addEventListener("dblclick", function(event) {
        console.log("Double click detected")
        clearTimeout(clickTimeout)
    })
})

// Move item
document.addEventListener("mousemove", function(event) {
    followItems.forEach(function(item) {
        if (onHold == true) {
            onMove = true
            if (onMove == true) {
                if (onItem.parentElement.id != "grid-container") {
                    gridContainer.appendChild(onItem)
                }
            }
            moveItem.call(item, event)
        }
    })
})

// Drop item
gridTiles.forEach(function(tile) {
    tile.addEventListener("mouseup", function(event) {
        followItems.forEach(function(item) {
            if (item.dataset.active === "true") { 
                onHold = false
                onMove = false 
                onItem = "" 
                if (tile.childElementCount != 0) {
                    document.getElementById(childParent).appendChild(item);
                } else {
                    tile.appendChild(item) 
                }
                if (tile.id == 12 || tile.id == 72) {
                    item.remove()
                }
            }

            item.dataset.active = "false"
            item.style.pointerEvents = "auto"
            item.style.position = "static"
            item.style.height = "100%"
            item.style.width = "100%"
            item.style.removeProperty("top")
            item.style.removeProperty("left") 
        });
    });
});

// Open mail
followItems.forEach(function(item) {
    item.addEventListener("dblclick", function(event) {
        console.log("asd");
    });
});


    </script>
</body>
</html>
